---
title: "Sackville Import"
author:
- Natasha Ryan
- Maximilian Berthold
- Douglas A. Campbell
date: "`r format(Sys.Date())`"
output:
  html_document:
    df_print: paged
    code_folding: hide
    keep_md: yes
    fig_caption: yes
    toc: TRUE
    toc_float: TRUE   
csl: plos-one.csl
editor_options: 
  chunk_output_type: inline
---

*Some of the code used to create this R Notebook was refurbished from "PlateAbImport.Rmd" written by Maximilian Berthold, Douglas A. Campbell, Melissa L. Rioux, Sarah J Gore, and Alyson MacCormack.*

# T Pseudonana 
```{r load libraries}
library(tidyverse)
library(lubridate)
library(googlesheets4)
library(googledrive)
```


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_chunk$set(fig.path='Output/')
```

# Set Project Variables
```{r set project variables}
Project <- "LOW"
Target_WI23 <- "Pilot/Protocol2"
TargetTaxa <- "Tpseudonana"
#TargetTaxa <- "Chlorella"
DataOut <- file.path("..","Data", "CleanData")
CalibData <- file.path("..","Data", "CalibData")

#ChlDataURL <- "https://docs.google.com/spreadsheets/d/1K4ibFMAjxHUszMHw-beBns0cqNqF2G7nZDF9Drm8MAQ/edit#gid=0"

#Temporary RunDate during auditing
#RunDate <- "Refit"

DataIn <- file.path("..","Data", "RawData", TargetTaxa, fsep = .Platform$file.sep)
DataRefDecay <- file.path("..","Data", "RawData",TargetTaxa, "DecayRef", fsep = .Platform$file.sep)
DataRLC <- file.path("..","Data", "RawData",TargetTaxa, "RLC", fsep = .Platform$file.sep)

FileID <- "fit"

FileEncode <- "UTF-8"
#guess_encoding says 'ASCII"

Delimiter <- ","

HeaderRows <- 0

```

```{r conversions}
us_s = 1000000
photons_umol = 6.022E17
A2_m2 = 1E20
```

```{r read ActPAR calibration files}
#ActPARCal <- readRDS("~/Dropbox/CampbellLabProtocols/ChlorophyllFluorescence/SolisenseInformation/SolisenseInformation_DCCalibParam.Rds")

ActPARCrossCal <- list.files(path = CalibData, full.names = TRUE) %>%
     map_df(~readRDS(file  = .))

#intercept set to 0 in lm in SolisenseInformation.Rproj/SolisenseCalibCompare.Rmd
ActPARCrossCal <- ActPARCrossCal |>
  rename(#Intercept = `estimate_(Intercept)`,
         Slope = `estimate_LIFT_Gen_Developer.cal`,
         #Intercept_SE = `std.error_(Intercept)`,
         Slope_SE = `std.error_LIFT_Gen_Developer.cal`)
```

```{r read ChlData}
# gs4_deauth()
# 
# ChlData <- read_sheet(ChlDataURL)


```


```{r set colours}
Wavelengths_nm = c(445, 470, 505, 535, 590)
Colours_nm = c("darkblue", "dodgerblue", "darkgreen", "yellowgreen",  "darkorange")


names(Colours_nm) <- Wavelengths_nm
Colours_nm

```

# Metadata Import
```{r import metadata}
#SackvilleMetadata <- read_sheet("")
```

# Fit File Import
```{r list PSI files for file import}
SolisenseFiles <- list.files(path = DataIn, pattern = FileID, full.names = TRUE)
SolisenseFiles

unique(duplicated(SolisenseFiles)) #test for duplicate file names

#RLCFiles <- list.files(path = DataRLC, pattern = FileID, full.names = TRUE)
#RLCFiles
```

```{r merging WI23 files}
#adding the files from WI23 since the FA24 Tpseudonana data collection was limites
DataIn_WI23 <- file.path("..","Data", "RawData", Target_WI23, fsep = .Platform$file.sep)
SolisenseFiles_WI23 <- list.files(path = DataIn_WI23, pattern = FileID, full.names = TRUE)
SolisenseFiles_WI23

unique(duplicated(SolisenseFiles_WI23)) #test for duplicate file names

```

```{r data read adds filename and cdate, warning=FALSE, message=FALSE, echo=FALSE}
#design choice 2 file reading functions or add a filetype variable to a single function
#stringsAsFactors =FALSE somewhere? 

read.delim_plus <- function(flnm, file_encode, delimiter, header_rows){read.delim(flnm, fileEncoding = file_encode, sep = delimiter,  skip = header_rows, row.names = NULL) %>% mutate(Filename = flnm)
}

```

# Create Data Frame 
purrr::map to read all files
```{r read Solisense files}
SolFits <- SolisenseFiles %>%
  map_df(~read.delim_plus(flnm =., file_encode = FileEncode, delimiter = Delimiter, header_rows = HeaderRows))

SolFits_WI23 <- SolisenseFiles_WI23 %>%
  map_df(~read.delim_plus(flnm =., file_encode = FileEncode, delimiter = Delimiter, header_rows = HeaderRows))


# RLCFits <- RLCFiles %>%
#   map_df(~read.delim_plus(flnm =., file_encode = FileEncode, delimiter = Delimiter, header_rows = HeaderRows))

```


```{r tidy SolFitsTrim ND}
#for NoDecayDataset
SolFitsTrim <- SolFits %>%
  filter(!grepl("----", DATE)) |> # remove rows with "----" 
  select(-c("RFID_User_Data", "Barcode_Data","PIF", "LEDSel", "Dur.Wat", "Lon", "Lat", "GPS_stat","X","Light_1", "Light_2", "Light_3","Light_4","Light_5","Light_6", "Tau1QA","Alp1QA","Alp1PQ","Tau1PQ"))  # remove superfluous columns

SolFitsTrim <- SolFitsTrim %>%
  mutate(Filename = str_remove(string = Filename, pattern = "_fit.csv")) %>%
  mutate(Filename = str_remove(string = Filename, pattern = "../Data/RawData/")) %>%
  separate(Filename, into=c("Species", "YYYYMMDD", "CultureID", "Temp_C", "PulseSpace_s"), sep = "([\\/\\_])", remove = FALSE) %>%
  mutate(YYYYMMDD = lubridate::ymd(YYYYMMDD),
          TIME = as.character(TIME)) %>%
   rename(ObsDate = DATE,
         ObsTime = TIME,
         FvFm = "Fv.Fm") |>
  mutate(Temp_C = str_remove(Temp_C, "C")) |>
  type_convert() |>
  mutate(PulseSpace_s = str_remove(PulseSpace_s, "S")) |>  #s vs S
  filter(PulseSpace_s %in% c(1, 2, 4, 8, 16)) |>  #remove rows with other PulseSpace_s
  mutate(PulseSpace_s = as.numeric(PulseSpace_s)) %>%
  mutate(ObsDateTime = lubridate::ymd_hms(paste(ObsDate, ObsTime))) %>%
  relocate(ObsDateTime, .after = ObsTime) %>%
  relocate(CultureID, .before = ObsDate) |>
  type_convert()

#normalize values to final stretch of 10 values from 'randomized' PSII pool
SolFitsTrim <-SolFitsTrim %>%
  group_by(Filename) %>%
  #arrange(ObsTime) |>
  mutate(Sigrunnorm =  Sig/mean(Sig[(length(Sig) - 10):length(Sig)], na.rm = TRUE),
         Forunnorm = Fo/mean(Fo[(length(Fo) - 10):length(Fo)], na.rm = TRUE),
         Fmrunnorm = Fm/mean(Fm[(length(Fm) - 10):length(Fm)], na.rm = TRUE),
         FvFmrunnorm = FvFm/mean(FvFm[(length(FvFm) - 10):length(FvFm)], na.rm = TRUE)) |>
  mutate(Flashnumber = row_number()) %>%
  mutate(Flashnumber2 = rank(ObsTime)) |>
  relocate(Flashnumber, .before=p) %>%
  mutate(Etime_s = (as.numeric(Time__mSec) - min(as.numeric(Time__mSec), na.rm = TRUE))/1000, .before=Flashnumber) %>%
  ungroup()

head(SolFitsTrim)

#add column for nominal SState for PSII that 'advance' with flash
SolFitsTrim <- SolFitsTrim |>
  mutate(SState = case_when(Flashnumber2 %% 4 == 1 ~ 1,
                    Flashnumber2 %% 4 == 2 ~ 2,
                    Flashnumber2 %% 4 == 3 ~ 3, 
                    Flashnumber2 %% 4 == 0 ~ 4))
```


**Odd issue in WithDecay files, with ChiSq appearing a second time after QARredMax column, offsetting column headers from proper data columns**
```{r fix column names}
#only use this chunk if analyzing data from Data-RawData-Pilot-WithDecay-Fit
#create new data frame, had to remove extra column

#OldNames <- c("Chisq", "Fo", "Fm","Fv.Fm", "Sig", "p","Alp1QA","Tau1QA","Alp2QA","Tau2QA","Alp3QA")
#NewNames <- c("Fo", "Fm","Fv.Fm", "Sig", "p","Alp1QA","Tau1QA","Alp2QA","Tau2QA","Alp3QA","Tau3QANew") #rename_with(~ NewNames[which(OldNames == .x)], .cols = OldNames) |>

  #select(-c(Tau3QA)) |>
  #rename(Tau3QA = Tau3QANew) |>

#SolFits2 <- SolFits[-32] 
#assign correct names
#Fixnames <- colnames(SolFits)[22:32]
#rename columns 
#colnames(SolFits2)[21:31] <- c(Fixnames)
```


```{r tidy SolFitsTrim WI23}
#for NoDecayDataset from the winter 2023 semester 
SolFitsTrim_WI23 <- SolFits_WI23 %>%
  filter(!grepl("----", DATE)) |> # remove rows with "----" 
  select(-c("RFID_User_Data", "Barcode_Data","PIF", "LEDSel", "Dur.Wat", "Lon", "Lat", "GPS_stat","X","Light_1", "Light_2", "Light_3","Light_4","Light_5","Light_6"))  # remove superfluous columns

SolFitsTrim_WI23 <- SolFitsTrim_WI23 %>%
  mutate(Filename = str_remove(string = Filename, pattern = "_fit.csv")) %>%
  mutate(Filename = str_remove(string = Filename, pattern = "../Data/RawData/Pilot/")) %>%
  separate(Filename, into=c("Species","YYYYMMDD", "CultureID", "Temp_C", "PulseSpace_s"), sep = "([\\/\\_])", remove = FALSE) %>%
  mutate(YYYYMMDD = lubridate::ymd(YYYYMMDD),
          TIME = as.character(TIME)) %>%
   rename(ObsDate = DATE,
         ObsTime = TIME,
         FvFm = "Fv.Fm") |>
  mutate(Temp_C = str_remove(Temp_C, "C")) |>
  mutate(Species = str_replace(Species, "Protocol2", "Tpseudonana")) %>%
  type_convert() %>%
  mutate(PulseSpace_s = str_remove(PulseSpace_s, "S")) |>  #s vs S
  filter(PulseSpace_s %in% c(1, 2, 4, 8)) |>  #remove rows with other PulseSpace_s
  mutate(PulseSpace_s = as.numeric(PulseSpace_s)) %>%
  mutate(ObsDateTime = lubridate::ymd_hms(paste(ObsDate, ObsTime))) %>%
  relocate(ObsDateTime, .after = ObsTime) %>%
  relocate(CultureID, .before = ObsDate) |>
  type_convert()

#normalize values to final stretch of 10 values from 'randomized' PSII pool
SolFitsTrim_WI23 <-SolFitsTrim_WI23%>%
  group_by(Filename) %>%
  #arrange(ObsTime) |>
  mutate(Sigrunnorm =  Sig/mean(Sig[(length(Sig) - 10):length(Sig)], na.rm = TRUE),
         Forunnorm = Fo/mean(Fo[(length(Fo) - 10):length(Fo)], na.rm = TRUE),
         Fmrunnorm = Fm/mean(Fm[(length(Fm) - 10):length(Fm)], na.rm = TRUE),
         FvFmrunnorm = FvFm/mean(FvFm[(length(FvFm) - 10):length(FvFm)], na.rm = TRUE)) |>
  mutate(Flashnumber = row_number()) %>%
  mutate(Flashnumber2 = rank(ObsTime)) |>
  relocate(Flashnumber, .before=p) %>%
  mutate(Etime_s = (as.numeric(Time__mSec) - min(as.numeric(Time__mSec), na.rm = TRUE))/1000, .before=Flashnumber) %>%
  ungroup()

head(SolFitsTrim)

#add column for nominal SState for PSII that 'advance' with flash
SolFitsTrim_WI23 <- SolFitsTrim_WI23 |>
  mutate(SState = case_when(Flashnumber2 %% 4 == 1 ~ 1,
                    Flashnumber2 %% 4 == 2 ~ 2,
                    Flashnumber2 %% 4 == 3 ~ 3, 
                    Flashnumber2 %% 4 == 0 ~ 4))
```


```{r tidy SolFitsTrim WD}
# for WithDecay Fit Dataset

#Think of better ways to do this
#Careful about RunDate, which is the label of a RunDate sub-folder.
#SolFitsTrim <- SolFits %>% 
  #filter(!grepl("----", DATE)) %>% # remove rows with "----"
 # select(-c("RFID_User_Data", "Barcode_Data","PIF", "Lon", "Lat", "GPS_stat","X")) %>% # remove superfluous columns
  #mutate(Filename = str_remove(string = Filename, pattern = "_fit.csv")) %>%
  #mutate(Filename = str_remove(string = Filename, pattern = "../Data/RawData/NoDecay/Fit/")) %>%
  #separate(Filename, into=c("YYYYMMDD", "CultureID", "Temp_C", "PulseSpace_s"), sep = "([\\/\\_])", remove = FALSE) %>%
  #separate(Filename, into = c("Project", "YYYYMMDD", "CultureID","Temp_C", "PulseSpace_s","Ex_WL", "Flashpower"), sep = "([\\/\\_])", remove = FALSE) %>%
 # mutate(YYYYMMDD = lubridate::ymd(YYYYMMDD),
         # TIME = as.character(TIME)) %>% #time-column may be read in as factor, and as.character changes it to numeric; using lubdridate::hms would only change the format to 13H 4M 2S but does not work later to merge into one DateTime-column
  #rename(ObsDate = DATE,
        # ObsTime = TIME,
       #  FvFm = "Fv.Fm") %>%
 # mutate(Ex_WL = as.factor(as.numeric(Ex_WL))) %>%
  #mutate(FvFm = as.numeric(as.character(FvFm)),
        # nm445 = as.numeric(as.character(Light_1)),
        # nm470 = as.numeric(as.character(Light_2)),
        # nm505 = as.numeric(as.character(Light_3)),
       # nm535 = as.numeric(as.character(Light_4)),
       #  nm590 = as.numeric(as.character(Light_5)),
        # IR = as.numeric(as.character(Light_6))) %>%
 # mutate(ObsDateTime = lubridate::ymd_hms(paste(ObsDate, ObsTime))) %>%
 # relocate(ObsDateTime, .after = ObsTime) %>%
 # relocate(CultureID, .before = ObsDate)

#SolFitsTrim <-SolFitsTrim %>%
#  group_by(Filename) %>%
 # mutate(Flashnumber = row_number()) %>%
 # relocate(Flashnumber, .before=p) %>%
  #mutate(Etime_s = (as.numeric(Time__mSec) - min(as.numeric(Time__mSec), na.rm = TRUE))/1000, .before=Flashnumber) %>%
  #ungroup()
```


```{r tidy RLC Fits}
#for NoDecayDataset
RLCFitsTrim <- RLCFits |>
  filter(!grepl("----", DATE)) |> # remove rows with "----" 
  select(-c("RFID_User_Data", "Barcode_Data","PIF", "LEDSel", "Dur.Wat", "Lon", "Lat", "GPS_stat","X"))  # remove superfluous columns

RLCFitsTrim <- RLCFitsTrim |>
  mutate(Filename = str_remove(string = Filename, pattern = "_RLC_fit.csv")) |>
    mutate(Filename = str_remove(string = Filename, pattern = "../Data/RawData/")) |>
  separate(Filename, into=c("Location", "Type", "YYYYMMDD", "CultureID", "Temp_C"), sep = "([\\/\\_])", remove = FALSE) %>%
  mutate(YYYYMMDD = lubridate::ymd(YYYYMMDD),
          TIME = as.character(TIME)) %>%
   rename(ObsDate = DATE,
         ObsTime = TIME,
         FvFm = "Fv.Fm") |>
  mutate(Temp_C = str_remove(Temp_C, "C")) |>
  type_convert() |>
  mutate(ObsDateTime = lubridate::ymd_hms(paste(ObsDate, ObsTime))) %>%
  relocate(ObsDateTime, .after = ObsTime) %>%
  relocate(CultureID, .before = ObsDate) |>
  type_convert()


RLCFitsTrim <- RLCFitsTrim |>
  group_by(Filename) |>
  arrange(ObsTime) |>
  mutate(Etime_s = (as.numeric(Time__mSec) - min(as.numeric(Time__mSec), na.rm = TRUE))/1000) %>%
  ungroup()

RLCFitsTrim <- RLCFitsTrim |>
  rowwise() |>
  mutate(PAR_ue = sum(Light_1, Light_2, Light_3, Light_4, Light_5, Light_6)) |>
  group_by(Filename) |>
  mutate(Dark1s = case_when(row_number() == 1 ~ 0,
                            row_number() %% 2 == 0 & row_number() > 1 ~ 0,
                            row_number() %% 2 == 1 & row_number() > 1 ~ 1)) |>
  ungroup()
     

head(RLCFitsTrim)
```


#Tpseudonana File Issues
```{r}
SolFitsTrim %>%
  filter(Flashnumber > 32)
```


Tpseudonana/20230911_NaOm1663_22C_8S  23 flashes
Tpseudonana/20230911_NaOm1663_22C_1S  31 flashes
Tpseudonana/20230911_NaOm1663_22C_2S  58 flashes- keep 1st 32 
Tpseudonana/20230911_NaOm1663_22C_4S  34 flashes- only first 29 are good?

Tpseudonana/20230912_NaOm1663_18C_8S  96 flashes- saved exact same run 3x
Tpseudonana/20230912_NaOm1663_18C_4S  96 flashes- saved exact same run 3x 
Tpseudonana/20230912_NaOm1663_18C_2S  96 flashes- saved exact same run 3x  
Tpseudonana/20230912_NaOm1663_18C_1S  96 flashes- saved exact same run 3x


```{r}
SolFitsTrim_first32 <- SolFitsTrim %>%
  filter(!Filename %in% c("Tpseudonana/20230911_NaOm1663_22C_4S")) %>% 
  group_by(Filename) %>%
  slice(head(row_number(),32)) %>% 
  mutate(Flashnumber2 = row_number()) %>%
  ungroup()

SolFitsTrim20230911_NaOm1663_22C_4S <- SolFitsTrim %>%
  filter(Filename == 'Tpseudonana/20230911_NaOm1663_22C_4S') %>%
  filter(Flashnumber %in% c(1:29)) %>%
  mutate(Flashnumber2 = row_number())

SolFitsTrim2 <- rbind(SolFitsTrim_first32, SolFitsTrim20230911_NaOm1663_22C_4S)
```

# Merge Files 
```{r}
SolFitsTrim_Combined <- rbind(SolFitsTrim2, SolFitsTrim_WI23)
```




# Basic plots 

Fm vs Flashnumber line; facet by temp 
```{r Fm vs Flashnumber(by T)}
#facetbytemp
SolFitsTrim_Combined %>%
  ggplot()+
  geom_line(aes(x=Flashnumber, y=FvFm, colour = as.factor(CultureID))) +
  facet_grid(rows = vars(PulseSpace_s), cols = vars(Temp_C)) +
  labs(title = TargetTaxa) +
  theme_bw()
```


```{r Fm vs Flashnumber(by T)}
SolFitsTrim %>%
  ggplot()+
  geom_line(aes(x=Flashnumber, y=Flashnumber2, colour = as.factor(PulseSpace_s))) +
  facet_grid(rows = vars(Temp_C)) +
  labs(title = TargetTaxa) +
  theme_bw()
```


```{r Fm vs Flashnumber(by T)}
RLCFitsTrim %>%
  ggplot()+
  geom_line(aes(x = PAR_ue, y = FvFm)) +
  facet_grid(rows = vars(Temp_C), cols = vars(CultureID)) +
  labs(title = TargetTaxa) +
  theme_bw()
```



FvFm vs Flashnumber line; facet by flash spacing
```{r Fm vs Flashnumber(by S)}
#facetbyspacing
SolFitsTrim2 %>%
  filter(CultureID == "MaPo1001") |>
  filter(ObsDate == "2023-09-18") |>
  filter(PulseSpace_s %in% c(1, 8)) |>
  filter(Temp_C %in% c(4, 12)) |>
  ggplot()+
  geom_line(aes(x=Flashnumber2, y= FvFm)) +
  facet_grid(rows = vars(Temp_C), cols = vars(PulseSpace_s)) +
  labs(title = paste("Antarctic Lake", TargetTaxa), x = "Flash Number", y = "Maximum Quantum Yield of PSII") +
  theme_bw()
```

RLC Plots
```{r rlc plots}
RLCFitsTrim |>
  ggplot() +
  geom_line(aes())
```


```{r save SolFitsTrim data}
#saveRDS(SolFitsTrim_Combined, file.path(DataOut, paste(Project, TargetTaxa, "SolFitsTrim.Rds", sep = "_"), fsep = .Platform$file.sep))
```


XXXX
Import RLC data
Import DecayRef data? (or use Tau from RLC?)
Merge with MetaData

**Very rough** results:   
At **10c**        
Flash spacing- Very approximate # of flashes
0.5s-18   
1s-14   
1s-14   
4s-12   
8s-8    

At 10c, maintains periodicity longest at 0.5, followed by 1&2, then 4, and finally 8 damps out fastest        
    -as expected    

Maximum fluorescence is more variable   
    -why?   

At **18c**,   
Flash spacing- Very approximate # of flashes    
0.5s-16   
1s-12   
1s-10   
4s-8      
8s-8  


At 18c, same pattern in flash duration but overall shorter    

(line kinda shows it better than point, ask campbell?)    

Biggest gap between 10&18c is at 4s   
    -why?   

XXXXXX


**One to use** (according to Campbell):    
FvFm vs Flashnumber point 
```{r FvFm vs Flashnumber}
SolFitsDecayTrim %>%
  ggplot()+
  geom_point(aes(x=Flashnumber, y= FvFm, group=Temp_C, colour=Temp_C)) +
  facet_grid("PulseSpace_s") +
  scale_x_continuous(limits=c(0,16), breaks=seq(0,16,4)) +
  scale_colour_manual(values = c("lightsteelblue3","palevioletred4")) +
  theme(legend.position = "right") + xlab("Flash Number") + ylab("Maximum Quantum Yield of PSII") + 
  labs(colour="Temperature °C") +
  theme_bw(base_size = 14)

SolFitsDecayTrim %>%
  filter(PulseSpace_s %in% c(0.5, 8)) %>%
  ggplot()+
  geom_point(aes(x=Flashnumber, y=as.numeric(FvFm), group=Temp_C, colour=Temp_C)) +
  geom_line(aes(x=Flashnumber, y=as.numeric(FvFm), group=Temp_C, colour=Temp_C), linewidth = 0.2) +
  facet_grid(cols = vars(PulseSpace_s), rows = vars(Temp_C)) +
  scale_x_continuous(limits=c(0,16), breaks=seq(0,16,4)) +
  scale_colour_manual(values = c("lightsteelblue3","palevioletred4")) +
  theme(legend.position = "right") + xlab("Flash Number") + ylab("Maximum Quantum Yield of PSII") + 
  labs(colour="Temperature °C") +
  theme_bw(base_size = 14)

ggsave(
  "DiatomFlashCyclesDecay.png",
  plot = last_plot(),
  path = file.path("..", "Output")
)
```

FvFm vs Time point
```{r FvFm vs Time}
SolFitsDecayTrim %>%
  ggplot()+
  geom_point(aes(x=Etime_s, y=as.numeric(FvFm), group=Temp_C, colour=Temp_C)) +
  facet_grid("PulseSpace_s") +
  scale_colour_manual(values = c("steelblue2","maroon")) +
  theme(legend.position = "right") + xlab("Time Elapsed (s)") + ylab("Maximum Quantum Yield of PSII") + 
  labs(colour="Temperature °C") +
  theme_bw()
```

FvFm vs Flashnumber as line; facet by spacing
```{r FvFm vs Flashnumber (by S)}
#facet by spacing 
SolFitsDecayTrim %>%
  ggplot()+
  geom_line(aes(x=Flashnumber, y=as.numeric(FvFm), group=Temp_C, colour=Temp_C)) +
  facet_grid("PulseSpace_s") +
  scale_x_continuous(limits=c(0,20), breaks=seq(0,20,4)) +
  scale_colour_manual(values = c("steelblue2","maroon")) +
  theme(legend.position = "right") + xlab("Flash Number") + ylab("Maximum Quantum Yield of PSII") + 
  labs(colour="Temperature °C") +
  theme_bw()
```

FvFm vs Flashnumber as line; facet by temp
```{r FvFm vs Flashnumber (by t)}
# facet by temp
SolFitsDecayTrim %>%
  ggplot()+
  geom_line(aes(x=Flashnumber, y=as.numeric(FvFm), group=PulseSpace_s, colour=PulseSpace_s)) +
  facet_grid("Temp_C") +
  #scale_x_continuous(breaks=seq(0,32,4)) +
  scale_x_continuous(limits=c(0,16), breaks=seq(0,16,4)) +
  #scale_colour_manual(values = c("steelblue2","maroon")) +
  theme(legend.position = "right") + xlab("Flash Number") + ylab("Maximum Quantum Yield of PSII") + 
  labs(colour="Temperature °C") +
  theme_bw()
```



# Bibliography

