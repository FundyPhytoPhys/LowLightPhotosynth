---
title: "Wavelet transformation"
author:
- Maximilian Berthold
date: "`r format(Sys.Date())`"
output:
  html_document:
    df_print: paged
    code_folding: hide
    keep_md: yes
    fig_caption: yes
    toc: TRUE
    toc_float: TRUE   
csl: plos-one.csl
editor_options: 
  chunk_output_type: inline
---

```{r load libraries}
library(tidyverse)
library(readxl)
library(stringr)
library(broom)
#library(knitr)
library(minpack.lm)
#library(OneR)
library(lubridate)
library(reshape2)
library(changepoint)
library(chngpt)
library(broom)
library(Rwave)
library(WaveletComp)
```

# Set Project Variables
```{r set project variables}
Project <- "LOW"
DataIn <- file.path("..","Data", "CleanData")
CalibData <- file.path("..","Data", "CalibData")
#TargetTaxa = "Chlorella"
TargetData <- "Takuvik"
TargetTaxa <- "Fragilariopsis"
FileID <- "SolFitsTrim"
```


```{r import clean data}
FitFilesSol <- list.files(path = DataIn, pattern = paste(TargetData,TargetTaxa,FileID, sep = "_"), full.names = TRUE)

read.RDS <- function(flnm){readRDS(flnm) %>%
    mutate(filename = flnm)
}

#test for duplicate file names
unique(duplicated(FitFilesSol))

SolFits <- FitFilesSol %>%
  map_df(~read.RDS(flnm = .))

#add column for nominal SState for PSII that 'advance' with flash
SolFits <- SolFits |>
  mutate(SState = case_when(Flashnumber %% 4 == 1 ~ 1,
                    Flashnumber %% 4 == 2 ~ 2,
                    Flashnumber %% 4 == 3 ~ 3, 
                    Flashnumber %% 4 == 0 ~ 4))
```


```{r create functions}
wavelet <- function(data){wavelet_result <- analyze.wavelet(data, "FvFmrunnorm",
                                     method = "white.noise",
                                     loess.span = 0,
                                     dt = 1, dj = 1/250,
                                     lowerPeriod = 1, upperPeriod = 32,
                                     make.pval = TRUE, n.sim = 100)
result_name <- paste(deparse(substitute(data)), "_wavelet_result")
  assign(result_name, wavelet_result, envir = .GlobalEnv)
return(wavelet_result)
}

reconstructwave <- function(wavelet_list, siglvl = 0.05) {
  reconstructed_list <- lapply(wavelet_list, function(wave) {
    reconstruct(wave, siglvl = siglvl)
  })
   recon_name <- paste(deparse(substitute(wavelet_list)), "_reconstructed")
  assign(recon_name, reconstructed_list, envir = .GlobalEnv)
  return(reconstructed_list)
}
```


# 10°C

```{r}
test.data <- SolFits %>% 
  filter(Temp_C == "10", PulseSpace_s == 16)v

test.fit <- analyze.wavelet(test.data, "FvFmrunnorm",
                                     method = "white.noise",
                                     loess.span = 0,
                                     dt = 1, dj = 1/250,
                                     lowerPeriod = 1, upperPeriod = 32,
                                     make.pval = TRUE, n.sim = 100)

reconstruct(test.fit)


```


```{r WVT 16s 10C}
Data_16S_10C <- list(
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 16) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 16) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 16) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 16) %>% slice(97:127)))
  
wavelet_16s_10C <- lapply(Data_16S_10C, wavelet)

reconstructwave(wavelet_16s_10C)
```


```{r WVT 8s 10C}
Data_8S_10C <- list(
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 8) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 8) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 8) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 8) %>% slice(97:128)))

wavelet_8s_10C <- lapply(Data_8S_10C, wavelet)

reconstructwave(wavelet_8s_10C)
```


```{r WVT 4s 10C}
Data_4S_10C <- list(
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 4) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 4) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 4) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 4) %>% slice(97:128)))

wavelet_4s_10C <- lapply(Data_4S_10C, wavelet)

reconstructwave(wavelet_4s_10C)
```


```{r WVT 2s 10C}
Data_2S_10C <- list(
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 2) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 2) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 2) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 2) %>% slice(97:128)))

wavelet_2s_10C <- lapply(Data_2S_10C, wavelet)

reconstructwave(wavelet_2s_10C)
```


```{r WVT 1s 10C}
Data_1S_10C <- list(
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 1) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 1) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 1) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "10", PulseSpace_s == 1) %>% slice(97:128)))

wavelet_1s_10C <- lapply(Data_1S_10C, wavelet)

reconstructwave(wavelet_1s_10C)
```


# 6°C

```{r WVT 16s 6C}
Data_16S_6C <- list(
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 16) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 16) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 16) %>% slice(65:96)), # something odd 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 16) %>% slice(97:128)),
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 16) %>% slice(129:160)))

wavelet_16s_6C <- lapply(Data_16S_6C, wavelet)

reconstructwave(wavelet_16s_6C)
```


```{r WVT 8s 16C}
Data_8S_6C <- list(
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 8) %>% slice(1:32)), #funky
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 8) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 8) %>% slice(65:96)),  
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 8) %>% slice(97:128)),
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 8) %>% slice(129:160)))

wavelet_8s_6C <- lapply(Data_8S_6C, wavelet)

reconstructwave(wavelet_8s_6C)
```


```{r WVT 4s 6C}
Data_4S_6C <- list(
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 4) %>% slice(1:32)), #funky
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 4) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 4) %>% slice(65:96)),  
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 4) %>% slice(97:128)),
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 4) %>% slice(129:160)))

wavelet_4s_6C <- lapply(Data_4S_6C, wavelet)

reconstructwave(wavelet_4s_6C)
```


```{r WVT 2s 6C}
Data_2S_6C <- list(
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 2) %>% slice(1:32)), #funky
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 2) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 2) %>% slice(65:96)), #also funky 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 2) %>% slice(97:128)),
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 2) %>% slice(129:160)))

wavelet_2s_6C <- lapply(Data_2S_6C, wavelet)

reconstructwave(wavelet_2s_6C)
```


```{r WVT 1s 6C}
Data_1S_6C <- list(
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 1) %>% slice(1:32)), #funky
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 1) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 1) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 1) %>% slice(97:128)),
  (SolFits %>% filter(Temp_C == "6", PulseSpace_s == 1) %>% slice(129:160)))

wavelet_1s_6C <- lapply(Data_1S_6C, wavelet)

reconstructwave(wavelet_1s_6C)
```

# 2°C

```{r WVT 16s 2C}
Data_16S_2C <- list(
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(65:96)), #funky
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(97:128)), #funky
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(129:160)), #funky
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(161:192)),
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 16) %>% slice(193:224)))

wavelet_16s_2C <- lapply(Data_16S_2C, wavelet)

reconstructwave(wavelet_16s_2C)
```


```{r WVT 8s 2C}
Data_8S_2C <- list(
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 8) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 8) %>% slice(33:64)), #funky
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 8) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 8) %>% slice(97:128)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 8) %>% slice(129:160)),
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 8) %>% slice(161:192)))

wavelet_8s_2C <- lapply(Data_8S_2C, wavelet)

reconstructwave(wavelet_8s_2C)
```


```{r WVT 4s 2C}
Data_4S_2C <- list(
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 4) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 4) %>% slice(33:64)), #funky
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 4) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 4) %>% slice(97:128)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 4) %>% slice(129:160)),
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 4) %>% slice(161:192)))

wavelet_4s_2C <- lapply(Data_4S_2C, wavelet)

reconstructwave(wavelet_4s_2C)
```


```{r WVT 2s 2C}
Data_2S_2C <- list(
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 2) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 2) %>% slice(33:64)),
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 2) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 2) %>% slice(97:128)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 2) %>% slice(129:160)),
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 2) %>% slice(161:192)))

wavelet_2s_2C <- lapply(Data_2S_2C, wavelet)

reconstructwave(wavelet_2s_2C)
```


```{r WVT 1s 2C}
Data_1S_2C <- list(
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 1) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 1) %>% slice(33:64)), #funky
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 1) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 1) %>% slice(97:128)), 
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 1) %>% slice(129:160)),
  (SolFits %>% filter(Temp_C == "2", PulseSpace_s == 1) %>% slice(161:192)))

wavelet_1s_2C <- lapply(Data_1S_2C, wavelet)

reconstructwave(wavelet_1s_2C)
```

# 0°C

```{r WVT 16s 0C}
Data_16S_0C <- list(
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 16) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 16) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 16) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 16) %>% slice(97:128))) 

wavelet_16s_0C <- lapply(Data_16S_0C, wavelet)

reconstructwave(wavelet_16s_0C)
```

```{r WVT 8s 0C}
Data_8S_0C <- list(
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 8) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 8) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 8) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 8) %>% slice(97:128))) 

wavelet_8s_0C <- lapply(Data_8S_0C, wavelet)

reconstructwave(wavelet_8s_0C)
```

```{r WVT 4s 0C}
Data_4S_0C <- list(
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 4) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 4) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 4) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 4) %>% slice(97:128))) 

wavelet_4s_0C <- lapply(Data_4S_0C, wavelet)

reconstructwave(wavelet_4s_0C)
```


```{r WVT 2s 0C}
Data_2S_0C <- list(
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 2) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 2) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 2) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 2) %>% slice(97:128))) 

wavelet_2s_0C <- lapply(Data_2S_0C, wavelet)

reconstructwave(wavelet_2s_0C)
```


```{r WVT 1s 0C}
Data_1S_0C <- list(
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 1) %>% slice(1:32)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 1) %>% slice(33:64)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 1) %>% slice(65:96)), 
  (SolFits %>% filter(Temp_C == "0", PulseSpace_s == 1) %>% slice(97:128))) 

wavelet_1s_0C <- lapply(Data_1S_0C, wavelet)

reconstructwave(wavelet_1s_0C)
```










```{r Plot of wavelet power 16 s 10C}
#sequential lines act like they are piped; need to run as a unit
#png(filename = "../Output/AvPw_WT_Fragilariopsis_SolFits_8s_10C.png")
wt.avg(WVT_16s_10C_a, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1,   #set level to mark significance
periodlab = "Periodicity",
main = "Fragilariopsis 16s, 10C, a") 
#dev.off()

wt.avg(WVT_16s_10C_b, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1,   
periodlab = "Periodicity",
main = "Fragilariopsis 16s, 10C, b") 

wt.avg(WVT_16s_10C_c, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1,   
periodlab = "Periodicity",
main = "Fragilariopsis 16s, 10C, c") 

wt.avg(WVT_16s_10C_d, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1,   
periodlab = "Periodicity",
main = "Fragilariopsis 16s, 10C, d")
```


```{r Image plot of wavelet power spectrum 16 s 10C}
MP_DeSpBl_16s_10c_a <- max(WVT_16s_10C_a$Power)
MP_DeSpBl_16s_10c_b <- max(WVT_16s_10C_b$Power)
MP_DeSpBl_16s_10c_c <- max(WVT_16s_10C_c$Power)
MP_DeSpBl_16s_10c_d <- max(WVT_16s_10C_d$Power)

#y axis is log2 scale not linear
#png(filename = "../Output/WT_Fragilariopsis_SolFits_8s_10C.png")
wt.image(WVT_16s_10C_a, periodlab = "Periodicity",
color.key= "i", 
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl_16s_10c_a,
#show.date = TRUE, date.format = "%F %S",
main = "Fragilariopsis 16s, 10C, a")
#dev.off()

wt.image(WVT_16s_10C_b, periodlab = "Periodicity",
color.key= "i", 
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl_16s_10c_b,
#show.date = TRUE, date.format = "%F %S",
main = "Fragilariopsis 16s, 10C, b")

wt.image(WVT_16s_10C_c, periodlab = "Periodicity",
color.key= "i", 
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl_16s_10c_c,
#show.date = TRUE, date.format = "%F %S",
main = "Fragilariopsis 16s, 10C, c")

wt.image(WVT_16s_10C_d, periodlab = "Periodicity",
color.key= "i", 
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl_16s_10c_d,
#show.date = TRUE, date.format = "%F %S",
main = "Fragilariopsis 16s, 10C, d")
```



```{r WVT Test 4 s 10C}

LOW_SolFits_4s_10C <- LOW_SolFits %>%
  filter(Temp_C == "10",
         PulseSpace_s == 4)

WVT_10C_4s <- analyze.wavelet(LOW_SolFits_4s_10C, "FvFm",
                        method = "white.noise",
                        loess.span = 0, 
                        dt = 1, dj = 1/500,
                        lowerPeriod = 2, upperPeriod = 36,
                        make.pval=TRUE, n.sim = 100)

MP_DeSpBl <- max(WVT_10C_4s$Power)

png(filename = "../Output/AvPw_WT_LOW_Fragilariopsis_SolFits_4s_10C.png")
wt.avg(WVT_10C_4s, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1, 
periodlab = "Periodicity",
main = "Fragilariopsis 10C, Pulse space 4 sec")
dev.off()


png(filename = "../Output/WT_LOW_Fragilariopsis_SolFits_4s_10C.png")
wt.image(WVT_10C_4s, periodlab = "Periodicity",
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl,
show.date = TRUE, date.format = "%F %T",
main = "Fragilariopsis 10C, Pulse space 4 sec")
dev.off()

```

```{r WVT Test 1 s 10C}

LOW_SolFits_1s_10C <- LOW_SolFits %>%
  filter(Temp_C == "10",
         PulseSpace_s == 1)

WVT_10C_1s <- analyze.wavelet(LOW_SolFits_1s_10C, "FvFm",
                        method = "white.noise",
                        loess.span = 0, 
                        dt = 1, dj = 1/500,
                        lowerPeriod = 2, upperPeriod = 36,
                        make.pval =TRUE, n.sim = 100)

MP_DeSpBl <- max(WVT_10C_1s$Power)

#sequential lines act like they are piped; need to run as a unit
png(filename = "../Output/AvPw_WT_LOW_Fragilariopsis_SolFits_1s_10C.png")
wt.avg(WVT_10C_1s, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1,   #set level to mark significance
periodlab = "Periodicity",
main = "Fragilariopsis 10C, Pulse space 1 sec")
dev.off()

#y axis is log2 scale not linear
png(filename = "../Output/WT_LOW_Fragilariopsis_SolFits_1s_10C.png")
wt.image(WVT_10C_1s, periodlab = "Periodicity",
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl,
show.date = TRUE, date.format = "%F %S",
main = "Fragilariopsis 10C, Pulse space 1 sec")
dev.off()

```



```{r WVT Test 8 sec 10C}

LOW_SolFits_8s_10C <- LOW_SolFits %>%
  filter(Temp_C == "10C",
         PulseSpace_s == 8)

WVT_10C_8s <- analyze.wavelet(LOW_SolFits_8s_10C, "FvFm",
                        method = "white.noise",
                        loess.span = 0, 
                        dt = 1, dj = 1/500,
                        lowerPeriod = 2, upperPeriod = 36,
                        make.pval =TRUE, n.sim = 100)

MP_DeSpBl <- max(WVT_10C_8s$Power)

png(filename = "../Output/AvPw_WT_LOW_Takuvik_SolFits_8s_10C.png")
wt.avg(WVT_10C_8s, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1, 
periodlab = "Periodicity",
main = "Takuvik 10C, Pulse space 8 sec")
dev.off()


png(filename = "../Output/WT_LOW_Takuvik_SolFits_8s_10C.png")
wt.image(WVT_10C_8s, periodlab = "Periodicity",
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl,
show.date = TRUE, date.format = "%F %T",
main = "Takuvik 10C, Pulse space 8 sec")
dev.off()

```


```{r WVT Test 8 sec 18C}

LOW_SolFits_8s_18C <- LOW_SolFits %>%
  filter(Temp_C == "18C",
         PulseSpace_s == 8)

WVT_18C_8s <- analyze.wavelet(LOW_SolFits_8s_18C, "FvFm",
                        method = "white.noise",
                        loess.span = 0, 
                        dt = 1, dj = 1/500,
                        lowerPeriod = 2, upperPeriod = 36,
                        make.pval =TRUE, n.sim = 100)

MP_DeSpBl <- max(WVT_18C_8s$Power)

png(filename = "../Output/AvPw_WT_LOW_Takuvik_SolFits_8s_18C.png")
wt.avg(WVT_18C_8s, show.siglvl = TRUE, siglvl =  0.05,maximum.level = 1, 
periodlab = "Periodicity",
main = "Takuvik 18C, Pulse space 8 sec")
dev.off()


png(filename = "../Output/WT_LOW_Takuvik_SolFits_8s_18C.png")
wt.image(WVT_18C_8s, periodlab = "Periodicity",
legend.params = list(lab = "wavelet power levels"),
label.time.axis = TRUE,
plot.legend = TRUE, plot.contour = TRUE,
maximum.level = 1.001 * MP_DeSpBl,
show.date = TRUE, date.format = "%F %T",
main = "Takuvik 18C, Pulse space 8 sec")
dev.off()
```

